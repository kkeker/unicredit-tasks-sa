# Общие правила для проектируемых систем

## Пояснение по нотации

Диаграммы используют нотацию ArchiMate раздела Application.

- Системы: Платформа данных, Каталог бизнес-событий и Система проверки паспартов по черным спискам - являются Служебными Сервисами потому что не реализуют ни какую бизнес-операцию и не предоставляют продукт. Они могут иметь или не иметь UI для управления, но их задачи весьма утилитарны.
- Системы: Карточка ФЛ, Карточка ЮЛ, Связи ЮЛ и Системы-потребители - являются Системами Устойчивых Бизнес Операций, потому что реализуют бизнес-сервисы и участвуют в бизнес процессах.
- Системы: "ИС МВД РФ черные списки паспортов" и не указанная на схеме подразумеваемая группа систем-источников данных для Связи ЮЛ вроде платформ открытых данных РФ - являются сторонними системами.

Концептуальная архитектура - не содержит интерфейсов и пли протоколов взаимодействия, не раскрывает детали реализации конкретной ИС и не отображает утилитарные системы вроде iPaaS для реализации взаимодействия ИС, а лишь верхнеуровнево показывает процесс взаимодествия. где связи читаются как "Использует" вне зависимости от потока данных.

Подобные системы реализуются однотипно и их базовые правила таковы:
- доступ к их данным происходит через витрины платформы данных, куда такие системы отправляют поток изменений (похожий на CDC) своей объектной логической модели данных, сопоставимой с Единой моделю данных компании.
- имеет асинхронный интерфейс Apache Kafka если у системы есть множество данных, которые можно получить как поток по запросу или по инициативе самой системы (обновление данных в самой ИС).
- имеет интеграцию с Каталогом бизнес-событий, который реализован на базе Apache ActiveMQ Artemis (стал стандартом банковской индустрии) по протоколу artemismq (не amqp) и регистрирует свой контракт + описание + триггер в реестре бизнес-событий Каталога бизнес-событий.
- имеет свою БД для владения данными, может иметь кеш.
- различные интерфейсы реализуют единый сервис этой ИС.
- может состоять из подсистем и элементов систем, где единицы развертывания не имеют значения (монолит, soa, msa, облачная функция).
- интерфейсы такой системы могут быть реализованые через сторонние интеграционные системы вроде ESB, iPaaS, ServiceMesh, DataLake, DWH, но нотационно относятся к ИС, которая их предоставила.
- часто ИС реализует несколько интерфейсов сразу: rest для синхронных несложных запросов в систему или для работы собственнго UI настройки этой ИС; kafka как стриминг-интерфейс если ИС рассылает множественные изменения данных (обычно реализуется через iPaaS); mq для отправки бизнес-событий в Каталог бизнес-событий; витрину данных в Платформе данных, которая обычно представляет из себя частную реализацию агрегации данных для конкретного потребителя с учетом нагрузки потребителя; ui являющиейся интерфейсом для канальных приложений.
- все интерфейсы имеют строгие контакрты в виде зарегистрированной модели стриминга изменений в Платформу данных, зарегстрированнного формата событий в Каталог бизнес-событий, зарегистрированного контракта REST API и строго формата дизайна и набора компонентов для использования каналах.
- стрим сообщений в Kafka напрямую между разными ИС и стрим сообщений данных в Платформу данных - это один и тот же поток данных логической модели данных ИС. Сообщения в Каталог бизнес-событий - это статусы той же логической модели данных, которая отправляется через Kafka. REST-интерфейсы должны предоставлять операции над той же самой логической моделью данных, которая предоставляется через прочие интерфейсы.

### Интеграционные сценарии
1. REST API - синхронные запросы от UI или другой ИС, когда нужен синхронный процесс, но данных не так много, они не создают тяжелый запрос/ответ и укладываются в лимиты ожидания ответа.
2. Kafka - асинхронный стриминг объектной модели, может потребляться напрямую другой ИС или через платформу данных, где будет разложен в модель хранения, может быть сопоставлен с моделями других ИС и на основе этих моделей могут быть постороены дата-продукты. Сам по себе может триггером к получению данных (EDA) или может дублироваться событием из каталога бизнес-событий для сверки и перечитывания стриминга. Также Kafka-интерфейс может быть использован для batch-заданий на обработку, которые нельзя использовать в REST.
3. DB Connect - синхронный забор данных только из платформы данных, запрещен между ИС. Это может быть дата-продукт в виде отдельной кешированной системы витрин поверх собственной подсистемы хранения данных, рассчитанной на OLAP-нагрузку или это может быть view-снутри БД ИС, пользоваться которой разрешено только ETL-платформы данных, если сама ИС не в востоянии создать этот поток.
4. ArtemisMQ - асинхронный событийный интерфейс через iPaaS вроде Каталога бизнес-событий, где события могут быть агрегированы с разных ИС (например, событие выдачи кредита в редитном конвеере). Может быть триггером для получения данных из платформы данных или через rest api.

Таким образом, можно напрямую получить данные от ИС через REST или Kafka, можно получить данные через DB Connect в платформе данных, можно комбинировать эти варианты. Триггером может быть раписание, пользовтельские действия в другой ИС или процессы в ней, событий в каталоге бизнес-событий или сам по себе kafka-stream. Платформа данных может быть использована напрямую с выделением в ней дата-продукта (отдельная подсистема с заданными характеристиками глубины и срока хранения, кешированием и представлениями данных под ваши ФТ и НФТ) или из нее можно читать в свою промежуточную БД для создания обновляемого кеша быстрого чтения.