# Общие правила для проектируемых систем

## Пояснение по нотации

Диаграммы используют нотацию ArchiMate раздела Application.

- Системы: Платформа данных, Каталог бизнес-событий и Система проверки паспортов по черным спискам - являются Служебными Сервисами, поскольку не выполняют непосредственных бизнес-операций и не предоставляют продукты. У них может быть или не быть пользовательского интерфейса для управления, но их функции в основном утилитарны.
- Системы: Карточка ФЛ, Карточка ЮЛ, Связи ЮЛ и Системы-потребители - считаются Системами Устойчивых Бизнес Операций, так как они реализуют бизнес-сервисы и участвуют в бизнес-процессах.
- Системы: "ИС МВД РФ черные списки паспортов" и не указанные на схеме системы-источники данных для Связей ЮЛ, такие как платформы открытых данных РФ, рассматриваются как сторонние системы.

Концептуальная архитектура не включает в себя интерфейсы и протоколы взаимодействия и не раскрывает деталей реализации конкретной ИС, а только обобщенно отображает процесс взаимодействия. В данном контексте связи интерпретируются как "Использует", независимо от потока данных.

Подобные системы реализуются единообразно, и их основные правила следующие:
- Доступ к данным осуществляется через витрины платформы данных, в которые такие системы направляют поток изменений, аналогичный CDC (Change Data Capture), своей объектной логической модели данных, соответствующей Единой модели данных компании.
- Имеется асинхронный интерфейс Apache Kafka в случае наличия большого объема данных, которые можно получить как поток по запросу или по инициативе самой системы (обновление данных в самой ИС).
- Имеется интеграция с Каталогом бизнес-событий, реализованным на базе Apache ActiveMQ Artemis (стандартом в банковской индустрии) с использованием протокола artemismq (не amqp), который регистрирует контракт, описание и триггер в реестре бизнес-событий Каталога бизнес-событий.
- Есть собственная база данных для хранения данных и возможно наличие кеша.
- Различные интерфейсы этой системы реализуют единую службу ИС.
- Система может состоять из подсистем и элементов, где единицы развертывания (deployment units) не имеют значения (монолит, SOA, MSA, облачная функция).
- Интерфейсы такой системы могут быть реализованы через сторонние интеграционные системы, такие как ESB, iPaaS, ServiceMesh, DataLake, DWH, но нотационно они относятся к ИС, которая предоставила эти интерфейсы.
- Часто такие ИС реализуют несколько интерфейсов одновременно: REST для синхронных и несложных запросов в систему или для работы с собственным пользовательским интерфейсом настройки этой ИС; Kafka в качестве стриминг-интерфейса, если ИС рассылает множество изменений данных (часто реализуется через iPaaS); MQ для отправки бизнес-событий в Каталог бизнес-событий; витрину данных в Платформе данных, которая обычно представляет собой частную реализацию агрегации данных для конкретного потребителя с учетом нагрузки потребителя; пользовательский интерфейс, который служит интерфейсом для канальных приложений.
- Все интерфейсы имеют строгие контракты, представленные в виде зарегистрированной модели изменений в Платформу данных, зарегистрированного формата событий в Каталоге бизнес-событий, зарегистрированного контракта REST API и строгого формата дизайна и набора компонентов для использования в каналах.
- Поток сообщений в Kafka между разными ИС и поток сообщений данных в Платформу данных представляют собой один и тот же логический поток данных модели данных ИС. Сообщения в Каталоге бизнес-событий представляют собой статусы той же самой логической модели данных, которая отправляется через Kafka. REST-интерфейсы должны предоставлять операции над той же самой логической моделью данных, которая предоставляется через другие интерфейсы.

### Интеграционные сценарии
1. REST API - синхронные запросы от пользовательского интерфейса (UI) или другой информационной системы (ИС), когда требуется синхронный процесс, количество данных ограничено и запрос/ответ не создают значительной нагрузки, при этом укладываются в ожидаемые временные рамки.
2. Kafka - асинхронный стриминг объектной модели данных, может быть потребляем напрямую другой ИС или через платформу данных, где данные будут преобразованы в модель хранения. Также Kafka может сопоставляться с моделями других ИС, что позволяет создавать дата-продукты. Kafka может действовать как инициатор получения данных (Event-Driven Architecture, EDA), или использоваться для дублирования событий из каталога бизнес-событий с целью проверки и повторной передачи данных. Кроме того, интерфейс Kafka может быть задействован для выполнения пакетных операций обработки данных, которые не могут быть реализованы через REST.
3. DB Connect - синхронное получение данных исключительно из платформы данных, исключая запросы между ИС. Это может представлять собой дата-продукт в виде отдельной кешированной системы-витрины поверх собственной системы хранения данных, оптимизированной для OLAP-нагрузки. Также это может быть представление (view) внутри базы данных ИС, доступ к которому разрешен только ETL-платформам данных, если сама ИС не способна предоставить данный поток.
4. ArtemisMQ - асинхронный событийный интерфейс через iPaaS, такой как Каталог бизнес-событий, где события могут быть агрегированы из разных ИС (например, события, связанные с процессом выдачи кредитов в банковском конвейере). ArtemisMQ может выступать в качестве инициатора получения данных из платформы данных или через REST API.

Таким образом, данные можно получать напрямую от ИС через REST или Kafka, а также через DB Connect в платформе данных. Возможны комбинированные варианты. Инициаторами могут служить расписания, пользовательские действия в других ИС, процессы в них, события в каталоге бизнес-событий или сам поток Kafka. Платформу данных можно использовать напрямую с выделением дата-продукта (как отдельная подсистема с определенными характеристиками хранения, кэширования и представлениями данных, соответствующими функциональным и нефункциональным требованиям), или можно читать данные из нее во внутреннюю промежуточную базу данных для создания обновляемого кеша для быстрого доступа.